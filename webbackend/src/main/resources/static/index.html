<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>실시간 주식 분석 대시보드</title>
    <link rel="stylesheet" href="css/common.css?v=2.0" />
    <link rel="stylesheet" href="css/dashboard.css?v=2.0" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
  </head>
  <body>
    <div class="popup-overlay" id="welcomePopup">
      <div class="popup-container">
        <div class="popup-header">
          <div class="popup-header-text">
            <h2 class="popup-title">새로워진 주식 분석 시스템</h2>
            <p class="popup-subtitle">
              냉철한 판단을 돕는 실시간 주식 분석 시스템을 만나보세요.
            </p>
          </div>
          <button class="popup-close" id="popupClose">×</button>
        </div>

        <div class="popup-content">
          <div class="popup-slides" id="popupSlides">
            <div class="popup-slide active">
              <h3 class="slide-title">1. 주요 지수를 한눈에 훑어보세요</h3>
              <p class="slide-description">
                최근 10일 간 국내지수 추이를 선 차트로 살펴볼 수 있으며,
                실시간으로 지수 정보를 제공합니다.
              </p>

              <div class="index-container">
                <div class="index-item">
                  <div class="index-header">
                    <span class="index-name">코스피</span>
                    <span class="index-value">2,500.63</span>
                  </div>
                  <div class="index-change positive">0.81% ▲ 20.00</div>
                  <canvas class="index-chart" id="kospiChart"></canvas>
                </div>
                <div class="index-item">
                  <div class="index-header">
                    <span class="index-name">코스닥</span>
                    <span class="index-value">688.67</span>
                  </div>
                  <div class="index-change positive">1.18% ▲ 8.00</div>
                  <canvas class="index-chart" id="kosdaqChart"></canvas>
                </div>
                <div class="index-item">
                  <div class="index-header">
                    <span class="index-name">코스피200</span>
                    <span class="index-value">332.22</span>
                  </div>
                  <div class="index-change positive">0.83% ▲ 2.73</div>
                  <canvas class="index-chart" id="kospi200Chart"></canvas>
                </div>
              </div>

              <p class="slide-description">
                해외 주요 지수도 선 차트로 살펴볼 수 있습니다.
              </p>

              <div class="index-container">
                <div class="index-item">
                  <div class="index-header">
                    <span class="index-name">S&P 500</span>
                    <span class="index-value">5,948.71</span>
                  </div>
                  <div class="index-change positive">0.53% ▲ 31.60</div>
                  <canvas class="index-chart" id="sp500Chart"></canvas>
                </div>
                <div class="index-item">
                  <div class="index-header">
                    <span class="index-name">다우산업</span>
                    <span class="index-value">43,870.35</span>
                  </div>
                  <div class="index-change positive">1.06% ▲ 461.88</div>
                  <canvas class="index-chart" id="dowChart"></canvas>
                </div>
                <div class="index-item">
                  <div class="index-header">
                    <span class="index-name">나스닥 종합</span>
                    <span class="index-value">18,972.42</span>
                  </div>
                  <div class="index-change positive">0.00% ▲ 6.28</div>
                  <canvas class="index-chart" id="nasdaqChart"></canvas>
                </div>
              </div>
            </div>

            <div class="popup-slide">
              <h3 class="slide-title">
                2. 오늘 뜨는 섹터. 버블 차트로 편하게 보세요
              </h3>
              <p class="slide-description">
                오늘 뜨는 인기 섹터를 상승률에 비례한 버블 차트로 직관적으로
                표현하고 관련 종목을 함께 보여드립니다.
              </p>

              <div class="sector-bubble-container">
                <h4 class="sector-bubble-title">오늘 뜨고 있는 섹터</h4>
                <div class="sector-bubble-chart" id="popupSectorBubbles">
                </div>
                <div class="sector-stocks-list" id="popupSectorStocks">
                </div>
              </div>
            </div>

            <div class="popup-slide">
              <h3 class="slide-title">
                3. 실시간 인기 조회 종목으로 투자 종목을 찾아보세요
              </h3>
              <p class="slide-description">
                고객님들이 실시간으로 조회하고 있는 인기 종목을 확인하고
                투자 종목을 찾는데 활용해보세요.
              </p>

              <div class="popular-stocks-card">
                <h4 class="popular-stocks-title">실시간 인기 TOP5</h4>
                <div class="popular-stocks-list" id="popupPopularStocks">
                </div>
              </div>
            </div>
          </div>

          <button class="popup-nav popup-nav-prev" id="popupPrev">‹</button>
          <button class="popup-nav popup-nav-next" id="popupNext">›</button>

          <div class="popup-pagination">
            <span class="pagination-dot active" data-slide="0"></span>
            <span class="pagination-dot" data-slide="1"></span>
            <span class="pagination-dot" data-slide="2"></span>
          </div>
        </div>

        <div class="popup-footer">
          <label class="popup-checkbox">
            <input type="checkbox" id="hideToday" />
            <span>오늘 하루 보지 않기</span>
          </label>
          <label class="popup-checkbox">
            <input type="checkbox" id="hideForever" />
            <span>다시 보지 않기</span>
          </label>
        </div>
      </div>
    </div>

    <header class="main-header">
      <div class="header-content">
        <div class="header-logo">
          <a href="/" aria-label="홈으로 이동">실시간 주식 분석 시스템</a>
        </div>
        <div class="header-actions">
          <nav class="nav-menu">
            <a href="/" class="nav-item active">홈</a>
            <a href="/email-subscription.html" class="nav-item">구독신청</a>
            <a href="/admin-login.html" class="nav-item">로그인</a>
          </nav>
          <button id="symbolSelectBtn" class="icon-btn" title="종목 선택">종목선택</button>
        </div>
      </div>
    </header>

    <main id="main-content" role="main">
      <div id="symbolSelectModal" class="modal-overlay" style="display: none">
        <div class="modal-content">
          <div class="modal-header">
            <h3>종목 선택</h3>
            <button class="modal-close" id="modalCloseBtn">&times;</button>
          </div>
          <div class="modal-body">
            <div class="control-group">
              <label for="symbolSelect">종목:</label>
              <select id="symbolSelect">
                <option value="AAPL">Apple (AAPL)</option>
                <option value="GOOGL">Google (GOOGL)</option>
                <option value="MSFT">Microsoft (MSFT)</option>
                <option value="AMZN">Amazon (AMZN)</option>
                <option value="TSLA">Tesla (TSLA)</option>
              </select>
            </div>

            <div class="controls">
              <div class="control-group">
                <label for="daysSlider">기간 (일):</label>
                <input
                  type="range"
                  id="daysSlider"
                  min="7"
                  max="365"
                  value="30"
                />
                <span id="daysValue">30</span>
              </div>

              <div class="control-group">
                <button id="refreshBtn">새로고침</button>
                <label>
                  <input type="checkbox" id="autoRefresh" /> 자동 새로고침
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <section class="content-section content-section--gray">
        <div class="container">
          <div class="dashboard-grid">
        <div class="card tabbed-card">
          <div class="tab-header">
            <button class="tab-button active" data-tab="realtime">
              실시간 주가
            </button>
            <button class="tab-button" data-tab="indicators">
              기술적 지표
            </button>
          </div>

          <div class="tab-content">
            <div id="realtimeTab" class="tab-pane active">
              <div class="metrics">
                <div class="metric">
                  <span class="metric-label">현재가:</span>
                  <span id="currentPrice" class="metric-value">$0.00</span>
                </div>
                <div class="metric">
                  <span class="metric-label">변동률:</span>
                  <span id="priceChange" class="metric-change">+0.00%</span>
                </div>
                <div class="metric">
                  <span class="metric-label">거래량:</span>
                  <span id="volume" class="metric-value">0</span>
                </div>
                <div class="metric">
                  <span class="metric-label">거래량 변화:</span>
                  <span id="volumeChange" class="metric-value">+0</span>
                </div>
              </div>
            </div>

            <div id="indicatorsTab" class="tab-pane">
              <div class="indicators">
                <div class="indicator">
                  <span class="indicator-label">RSI:</span>
                  <span id="rsi" class="indicator-value">0.0</span>
                  <span id="rsiStatus" class="indicator-status">정상</span>
                </div>
                <div class="indicator">
                  <span class="indicator-label">MACD:</span>
                  <span id="macd" class="indicator-value">0.000</span>
                  <span id="macdStatus" class="indicator-status">상승</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card tabbed-card">
          <div class="tab-header">
            <button class="tab-button active" data-tab="analysis">
              기술적 분석 상세
            </button>
            <button class="tab-button" data-tab="stats">거래 통계</button>
          </div>

          <div class="tab-content">
            <div id="analysisTab" class="tab-pane active">
              <div id="technicalIndicators" class="analysis-details">
                <div class="loading"></div>
                <p>분석 데이터를 불러오는 중...</p>
              </div>
            </div>

            <div id="statsTab" class="tab-pane">
              <div id="tradingStats" class="analysis-details">
                <div class="loading"></div>
                <p>통계 데이터를 불러오는 중...</p>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <h3>연결 상태 & 시스템 모니터</h3>
          <div id="connectionStatus">
            <div class="status-item">
              <span class="status-label">통신Api:</span>
              <span id="wsStatus" class="status-value neutral">연결 중...</span>
            </div>
            <div class="status-item">
              <span class="status-label">화면서버:</span>
              <span id="apiStatus" class="status-value neutral"
                >확인 중...</span
              >
            </div>
            <div class="status-item">
              <span class="status-label">데이터서버:</span>
              <span id="pythonApiStatus" class="status-value neutral"
                >확인 중...</span
              >
            </div>
            <div class="status-item">
              <span class="status-label">데이터 변경:</span>
              <span id="lastUpdateTime" class="status-value neutral">-</span>
            </div>
            <div class="status-item">
              <span class="status-label">데이터 확인:</span>
              <span id="messageCount" class="status-value neutral">0</span>
            </div>
            <div class="status-item">
              <span class="status-label">연결 실패:</span>
              <span id="reconnectCount" class="status-value neutral">0</span>
            </div>
            <div class="status-controls">
              <button class="btn-small" onclick="dashboard.checkSystemHealth()">
                시스템 체크
              </button>
              <button
                class="btn-small"
                onclick="dashboard.resetConnectionStats()"
              >
                통계 리셋
              </button>
            </div>
          </div>
        </div>

        <div class="card tabbed-card chart-card">
          <div class="tab-header">
            <button class="tab-button active" data-tab="price">
              가격 차트
            </button>
            <button class="tab-button" data-tab="volume">거래량</button>
          </div>

          <div class="tab-content">
            <div id="priceTab" class="tab-pane active">
              <div id="priceChart" class="chart-container"></div>
            </div>

            <div id="volumeTab" class="tab-pane">
              <div id="volumeChart" class="chart-container"></div>
            </div>
          </div>
        </div>

        <div class="card table-card">
          <h3>최근 거래 데이터</h3>
          <div class="table-container">
            <table id="dataTable">
              <thead>
                <tr>
                  <th>날짜</th>
                  <th>종가</th>
                  <th>거래량</th>
                  <th>RSI</th>
                  <th>MACD</th>
                  <th>BB 상단</th>
                  <th>BB 하단</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="7" class="loading">데이터를 불러오는 중...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="card news-card">
          <div class="card-header">
            <h3>관련 뉴스</h3>
            <div class="news-controls">
              <label>
                <input type="checkbox" id="includeKoreanNews" /> 한국어 뉴스 포함
              </label>
              <button id="refreshNewsBtn" class="btn-small">새로고침</button>
            </div>
          </div>
          <div id="newsContainer" class="news-container">
            <div class="loading">뉴스를 불러오는 중...</div>
          </div>
        </div>
      </section>
    </main>

    <footer class="main-footer">
      <div class="footer-content">
        <div class="footer-links">
          <a href="/company.html">회사소개</a>
          <a href="/terms.html">이용약관</a>
          <a href="/privacy.html">개인정보처리방침</a>
          <a href="/contact.html">고객센터</a>
        </div>
        <div class="footer-copyright">
          <p class="footer-logo">주식 분석 시스템. All Rights Reserved.</p>
        </div>
      </div>
    </footer>

    <script src="js/auth-menu.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/url-utils.js?v=2.0"></script>
    <script src="js/news.js"></script>
  </body>
</html>
